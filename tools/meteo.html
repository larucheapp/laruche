<!DOCTYPE html>
<html lang="fr" data-app="laruche">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>M√©t√©o Express ‚Äî La Ruche</title>
  <meta name="description" content="Un outil m√©t√©o simple et styl√© pour obtenir des pr√©visions pr√©cises en un clin d'≈ìil.">
  <style>
    :root {
      --color-bg: #FFFFFF;
      --color-bg-alt: #F7F8FA;
      --color-border: #E9EAF0;
      --color-text-primary: #141417;
      --color-text-secondary: #6B7280;
      --color-violet: #7C3AED;
      --color-violet-dark: #6D28D9;
      --radius-md: 12px;
      --radius-lg: 14px;
      --tool-max-w: 480px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { height: 100%; background-color: var(--color-bg); }
    body {
      height: 100vh; overflow: hidden; display: flex; flex-direction: column;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Inter", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--color-text-primary); line-height: 1.5; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }
    body[data-size="default"] { --tool-max-w: 480px; }
    body[data-size="wide"] { --tool-max-w: 960px; }
    body[data-size="xl"] { --tool-max-w: 1200px; }

    #bg-canvas { position: fixed; inset: 0; width: 100%; height: 100%; z-index: -1; }

    .app-header {
      flex-shrink: 0; background: var(--color-bg-alt); border-bottom: 1px solid var(--color-border);
      padding: 0 24px; display: flex; align-items: center; height: 70px;
    }
    .app-header a { display: inline-flex; align-items: center; }
    .logo-img { height: 70px; width: auto; vertical-align: middle; }

    .main-content {
      flex-grow: 1; display: flex; align-items: flex-start; justify-content: center;
      padding: 48px 24px; overflow-y: auto;
    }
    .tool-wrapper { display: flex; flex-direction: column; align-items: center; position: relative; width: 100%;}
    .tool-title {
      font-size: 1.75rem; font-weight: 600; padding: 12px 28px;
      background: linear-gradient(45deg, var(--color-violet), var(--color-violet-dark));
      color: #fff; border-radius: var(--radius-md); margin-bottom: -20px; position: relative; z-index: 5;
      box-shadow: 0 4px 14px -4px rgba(124, 58, 237, .4);
    }
    .generator-card {
      background: var(--color-bg); border: 1px solid var(--color-border); border-radius: var(--radius-lg);
      padding: 28px; padding-top: 40px; width: 100%; max-width: var(--tool-max-w);
      box-shadow: 0 4px 6px -1px rgb(0 0 0 / 5%), 0 2px 4px -2px rgb(0 0 0 / 5%);
      display: flex; flex-direction: column; gap: 24px;
      transition: background .5s ease-out, color .5s ease-out;
    }

    /* M√©t√©o Styles */
    .search-bar { display: flex; gap: 12px; }
    .form-input {
      flex-grow: 1; width: 100%; padding: 10px 14px; border: 1px solid var(--color-border); border-radius: var(--radius-md);
      font-size: 1rem; color: var(--color-text-primary); background:var(--color-bg);
      transition:border-color .2s, box-shadow .2s;
    }
    .form-input:focus{outline:none; border-color:var(--color-violet); box-shadow:0 0 0 3px rgba(124,58,237,.2)}

    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      font-weight:500; padding:10px 16px; border-radius:var(--radius-md); border:none; cursor:pointer;
      transition:background-color .2s, box-shadow .2s; font-size:14px;
    }
    .btn:focus-visible{outline:2px solid transparent; outline-offset:2px; box-shadow:0 0 0 3px rgba(124,58,237,.4)}
    .btn-primary{background:var(--color-violet); color:#fff}
    .btn-primary:hover:not(:disabled){background:var(--color-violet-dark)}
    .btn-primary svg { width: 18px; height: 18px; }

    .btn-secondary { background: var(--color-bg-alt); color: var(--color-text-primary); border: 1px solid var(--color-border); }
    .btn-secondary:hover:not(:disabled) { background: #f0f1f3; }
    
    #weather-content { min-height: 300px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; gap: 16px; }
    .initial-prompt p { font-size: 1.1rem; color: var(--color-text-secondary); }
    .initial-prompt .actions { display: flex; flex-direction: column; gap: 12px; width: 100%; max-width: 250px; margin-top: 16px; }
    .loader {
      border: 4px solid #f3f3f3; border-top: 4px solid var(--color-violet);
      border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    .weather-display { display: none; flex-direction: column; gap: 28px; width: 100%; }
    .current-weather { text-align: center; }
    .current-weather-icon { width: 128px; height: 128px; margin: 0 auto -10px; font-size: 96px; line-height: 1; display:flex; align-items:center; justify-content: center; }
    .current-temp { font-size: 5rem; font-weight: 700; line-height: 1; }
    .current-desc { font-size: 1.5rem; font-weight: 500; margin-top: -10px; }
    .current-city { font-size: 1.25rem; color: var(--color-text-secondary); }
    
    .current-details { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; padding: 16px; background: rgba(0,0,0,0.02); border-radius: var(--radius-md); border: 1px solid var(--color-border); }
    .detail-item { text-align: center; }
    .detail-item .value { font-weight: 600; font-size: 1.1rem; }
    .detail-item .label { font-size: 0.8rem; color: var(--color-text-secondary); text-transform: uppercase; }

    .forecast-section { display: flex; flex-direction: column; gap: 12px; }
    .forecast-title { font-size: 1.2rem; font-weight: 600; text-align: left; }
    .hourly-forecast { display: flex; gap: 16px; overflow-x: auto; padding: 12px 4px; }
    .hourly-forecast::-webkit-scrollbar { height: 6px; }
    .hourly-forecast::-webkit-scrollbar-track { background: #e9eaf0; border-radius: 3px; }
    .hourly-forecast::-webkit-scrollbar-thumb { background: #d1d3d8; border-radius: 3px; }
    .hour-item { flex-shrink: 0; text-align: center; }
    .hour-item .time { font-weight: 500; font-size: 0.9rem; }
    .hour-item .icon { width: 48px; height: 48px; font-size: 32px; display:flex; align-items:center; justify-content: center; }
    .hour-item .temp { font-weight: 600; }

    /* Dynamic background styles */
    .weather-card.is-day.clear { background: linear-gradient(to top, #ffd08a, #ff9a8b); color: #412a0e;}
    .weather-card.is-day.cloudy { background: linear-gradient(to top, #bdc3c7, #9aa2a8); color: #2c3e50;}
    .weather-card.is-day.rainy { background: linear-gradient(to top, #6a85b6, #bac8e0); color: #1e3a5f;}
    .weather-card.is-night.clear { background: linear-gradient(to top, #232526, #414345); color: #f0f0f0;}
    .weather-card.is-night.cloudy { background: linear-gradient(to top, #485461, #28313b); color: #e0e0e0;}
    .weather-card.is-night.rainy { background: linear-gradient(to top, #3a506b, #1c2541); color: #f0f0f0;}
    
    .weather-card.is-day .current-city, .weather-card.is-night .current-city,
    .weather-card.is-day .detail-item .label, .weather-card.is-night .detail-item .label
    { color: inherit; opacity: 0.8; }
    .weather-card.is-day .current-details, .weather-card.is-night .current-details { background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.2); }

  </style>
<link rel="stylesheet" href="/index.css">
</head>
<body data-size="default">
  <canvas id="bg-canvas"></canvas>

  <header class="app-header">
    <a href="index.html" aria-label="Accueil">
      <img src="logo-2.png" alt="Logo La Ruche" class="logo-img">
    </a>
  </header>

  <main class="main-content">
    <div class="tool-wrapper">
      <h1 class="tool-title">M√©t√©o Express</h1>

      <div id="weather-card" class="generator-card" role="region" aria-label="M√©t√©o Express">
        <div class="search-bar">
          <input type="text" id="city-input" class="form-input" placeholder="Entrez le nom d'une ville...">
          <button id="search-btn" class="btn btn-primary" aria-label="Rechercher">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
          </button>
        </div>
        
        <div id="weather-content">
          <!-- Contenu dynamique (invite, loader, erreur, m√©t√©o) -->
        </div>
      </div>
    </div>
  </main>

  <script>
    // Background hex grid (inchang√©)
    (function(){
      const c = document.getElementById('bg-canvas'); if(!c) return;
      const ctx = c.getContext('2d');
      function draw(){
        const dpr = window.devicePixelRatio || 1; const rect = c.getBoundingClientRect();
        c.width = rect.width * dpr; c.height = rect.height * dpr;
        ctx.setTransform(dpr,0,0,dpr,0,0); ctx.clearRect(0,0,rect.width,rect.height);
        const size = 24, hexW = 2 * size, hexH = Math.sqrt(3) * size, stepX = hexW * 3/4;
        ctx.strokeStyle = 'rgba(124,58,237,0.10)'; ctx.lineWidth = 1;
        for(let row=0; row*hexH < rect.height + hexH; row++){
          for(let col=0; col*stepX < rect.width + hexW; col++){
            const x = col * stepX, y = row * hexH + (col % 2 ? hexH/2 : 0);
            ctx.beginPath();
            for(let i=0;i<6;i++){
              const a = 2 * Math.PI / 6 * i, px = x + size * Math.cos(a), py = y + size * Math.sin(a);
              if(i===0) ctx.moveTo(px,py); else ctx.lineTo(px,py);
            }
            ctx.closePath(); ctx.stroke();
          }
        }
      }
      window.addEventListener('resize', draw, {passive:true}); draw();
    })();

    // Outil M√©t√©o Express
    document.addEventListener('DOMContentLoaded', () => {
      const cityInput = document.getElementById('city-input');
      const searchBtn = document.getElementById('search-btn');
      const weatherContent = document.getElementById('weather-content');
      const weatherCard = document.getElementById('weather-card');

      const WMO_CODES = {
        0: { day: '‚òÄÔ∏è', night: 'üåô', desc: 'Ciel d√©gag√©' }, 1: { day: 'üå§Ô∏è', night: '‚òÅÔ∏è', desc: 'Plut√¥t ensoleill√©' },
        2: { day: '‚õÖÔ∏è', night: '‚òÅÔ∏è', desc: 'Partiellement nuageux' }, 3: { day: '‚òÅÔ∏è', night: '‚òÅÔ∏è', desc: 'Nuageux' },
        45: { day: 'üå´Ô∏è', night: 'üå´Ô∏è', desc: 'Brouillard' }, 48: { day: 'üå´Ô∏è', night: 'üå´Ô∏è', desc: 'Brouillard givrant' },
        51: { day: 'üå¶Ô∏è', night: 'üåßÔ∏è', desc: 'Bruine l√©g√®re' }, 53: { day: 'üå¶Ô∏è', night: 'üåßÔ∏è', desc: 'Bruine mod√©r√©e' }, 55: { day: 'üåßÔ∏è', night: 'üåßÔ∏è', desc: 'Bruine forte' },
        61: { day: 'üå¶Ô∏è', night: 'üåßÔ∏è', desc: 'Pluie faible' }, 63: { day: 'üåßÔ∏è', night: 'üåßÔ∏è', desc: 'Pluie mod√©r√©e' }, 65: { day: 'üåßÔ∏è', night: 'üåßÔ∏è', desc: 'Pluie forte' },
        80: { day: 'üå¶Ô∏è', night: 'üåßÔ∏è', desc: 'Averses faibles' }, 81: { day: 'üåßÔ∏è', night: 'üåßÔ∏è', desc: 'Averses mod√©r√©es' }, 82: { day: '‚õàÔ∏è', night: '‚õàÔ∏è', desc: 'Averses violentes' },
        95: { day: '‚õàÔ∏è', night: '‚õàÔ∏è', desc: 'Orage' }
      };

      const showInitialPrompt = () => {
        weatherContent.innerHTML = `
          <div class="initial-prompt">
            <p>Obtenez la m√©t√©o instantan√©ment.</p>
            <div class="actions">
              <button id="geo-btn" class="btn btn-primary">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg>
                Utiliser ma position
              </button>
            </div>
            <p style="font-size: 14px; margin-top: 16px;">ou recherchez une ville ci-dessus.</p>
          </div>
        `;
        document.getElementById('geo-btn').addEventListener('click', getLocationWeather);
      };

      const showLoader = () => { weatherContent.innerHTML = '<div class="loader"></div>'; };
      const showError = (message) => { weatherContent.innerHTML = `<p>${message}</p>`; };

      const getLocationWeather = () => {
        if (navigator.geolocation) {
          showLoader();
          navigator.geolocation.getCurrentPosition(
            position => {
              const { latitude, longitude } = position.coords;
              fetchWeather(latitude, longitude);
            },
            () => {
              showError("La g√©olocalisation a √©t√© refus√©e. Veuillez rechercher une ville.");
            }
          );
        } else {
          showError("La g√©olocalisation n'est pas support√©e par votre navigateur.");
        }
      };
      
      const searchCityWeather = async () => {
          const city = cityInput.value.trim();
          if (!city) return;
          showLoader();
          try {
              const geoResponse = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1&language=fr&format=json`);
              const geoData = await geoResponse.json();
              if (geoData.results && geoData.results.length > 0) {
                  const { latitude, longitude, name } = geoData.results[0];
                  fetchWeather(latitude, longitude, name);
              } else {
                  showError(`Impossible de trouver la ville "${city}".`);
              }
          } catch (error) {
              showError("Une erreur est survenue lors de la recherche.");
          }
      };

      const fetchWeather = async (lat, lon, cityName = null) => {
        try {
          const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,is_day,weather_code,wind_speed_10m,relative_humidity_2m&hourly=temperature_2m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto`;
          const response = await fetch(url);
          const data = await response.json();
          displayWeather(data, cityName);
        } catch (error) {
          showError("Impossible de r√©cup√©rer les donn√©es m√©t√©o.");
        }
      };

      const displayWeather = (data, cityName) => {
        const { current, hourly, daily } = data;
        const weatherInfo = WMO_CODES[current.weather_code] || WMO_CODES[0];
        
        weatherCard.className = 'generator-card weather-card';
        const timeOfDay = current.is_day ? 'is-day' : 'is-night';
        const weatherType = weatherInfo.desc.toLowerCase().includes('pluie') || weatherInfo.desc.toLowerCase().includes('averse') ? 'rainy' : (weatherInfo.desc.toLowerCase().includes('nuage') || weatherInfo.desc.toLowerCase().includes('brouillard') ? 'cloudy' : 'clear');
        weatherCard.classList.add(timeOfDay, weatherType);

        weatherContent.innerHTML = `
          <div class="weather-display">
            <div class="current-weather">
              <div class="current-weather-icon">${current.is_day ? weatherInfo.day : weatherInfo.night}</div>
              <div class="current-temp">${Math.round(current.temperature_2m)}&deg;</div>
              <div class="current-desc">${weatherInfo.desc}</div>
              <div class="current-city">${cityName || 'Votre position'}</div>
            </div>

            <div class="current-details">
              <div class="detail-item">
                <div class="value">${Math.round(current.wind_speed_10m)} km/h</div>
                <div class="label">Vent</div>
              </div>
              <div class="detail-item">
                <div class="value">${current.relative_humidity_2m}%</div>
                <div class="label">Humidit√©</div>
              </div>
              <div class="detail-item">
                <div class="value">${Math.round(daily.temperature_2m_max[0])}&deg; / ${Math.round(daily.temperature_2m_min[0])}&deg;</div>
                <div class="label">Max / Min</div>
              </div>
            </div>

            <div class="forecast-section">
                <h3 class="forecast-title">Pr√©visions horaires</h3>
                <div class="hourly-forecast" id="hourly-container"></div>
            </div>
          </div>
        `;
        
        const hourlyContainer = document.getElementById('hourly-container');
        const now = new Date();
        const currentHour = now.getHours();
        
        const startIndex = hourly.time.findIndex(time => new Date(time).getHours() === currentHour);

        if (startIndex !== -1) {
            for (let i = startIndex; i < startIndex + 12 && i < hourly.time.length; i++) {
                const time = new Date(hourly.time[i]);
                const hourInfo = WMO_CODES[hourly.weather_code[i]] || WMO_CODES[0];
                const hourEl = document.createElement('div');
                hourEl.className = 'hour-item';
                hourEl.innerHTML = `
                    <div class="time">${time.getHours()}h</div>
                    <div class="icon">${current.is_day ? hourInfo.day : hourInfo.night}</div>
                    <div class="temp">${Math.round(hourly.temperature_2m[i])}&deg;</div>
                `;
                hourlyContainer.appendChild(hourEl);
            }
        }
        
        weatherContent.querySelector('.weather-display').style.display = 'flex';
      };

      searchBtn.addEventListener('click', searchCityWeather);
      cityInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') searchCityWeather();
      });

      showInitialPrompt();
    });
  </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>